async function cargarPuntos() {
  const url = `https://api.airtable.com/v0/${baseId}/${tableName}`;
  const headers = { Authorization: `Bearer ${airtableToken}` };
  const res = await fetch(url, { headers });
  const data = await res.json();

  data.records.forEach(record => {
    const f = record.fields;
    if (!(f.Latitud && f.Longitud)) return;

    const color = f.CheckIn ? 'green' : 'gray';
    const fillColor = f.CheckIn ? 'green' : '#888';
    const weight = 3;
    const radius = 12;

    if (f.Tipo === 2) {
      // Bicho: dibujar circleMarker y encima un divIcon pequeño con emoji o SVG
      const baseCircle = L.circleMarker([f.Latitud, f.Longitud], {
        radius: radius,
        color: color,
        fillColor: fillColor,
        fillOpacity: f.CheckIn ? 0.7 : 0.3,
        weight: weight
      }).addTo(map);

      // Crear icono pequeño sobre el círculo
      const iconHtml = `<div style="font-size: 18px; line-height: 18px; text-align: center; user-select:none;">🦌</div>`;
      const icon = L.divIcon({
        html: iconHtml,
        className: '', // sin estilos extra
        iconSize: [24, 24],
        iconAnchor: [12, 12] // anclar en centro
      });

      const iconMarker = L.marker([f.Latitud, f.Longitud], { icon: icon, interactive: false }).addTo(map);

      // Crear popup para ambos (se une en el circleMarker)
      baseCircle.bindPopup(`
        <b>${f.Nombre || 'Sin nombre'}</b><br>
        ${f.Direccion || 'Sin dirección'}<br>
        <b>Tipo:</b> Bicho<br>
        <b>Check-in:</b> ${f.CheckIn ? 'Sí' : 'No'}<br>
        <b>Persona:</b> ${f.Persona || 'Nadie'}<br>
        <button class="delete-btn" onclick="eliminarPunto('${record.id}')">Eliminar</button>
      `, { autoClose: false, closeOnClick: false });

      baseCircle.on('click', async () => {
        map.setView([f.Latitud, f.Longitud], 16);
        baseCircle.openPopup();
      });

    } else {
      // Ubicación normal (circleMarker)
      const marker = L.circleMarker([f.Latitud, f.Longitud], {
        radius: radius,
        color: color,
        fillColor: fillColor,
        fillOpacity: f.CheckIn ? 0.7 : 0.3,
        weight: weight
      }).addTo(map);

      marker.bindPopup(`
        <b>${f.Nombre || 'Sin nombre'}</b><br>
        ${f.Direccion || 'Sin dirección'}<br>
        <b>Tipo:</b> Ubicación<br>
        <b>Check-in:</b> ${f.CheckIn ? 'Sí' : 'No'}<br>
        <b>Persona:</b> ${f.Persona || 'Nadie'}<br>
        <button class="delete-btn" onclick="eliminarPunto('${record.id}')">Eliminar</button>
      `, { autoClose: false, closeOnClick: false });

      marker.on('click', async () => {
        map.setView([f.Latitud, f.Longitud], 16);
        marker.openPopup();

        if (!f.CheckIn) {
          const p = prompt("Tu nombre para hacer check-in:");
          if (!p) return;
          await fetch(`${url}/${record.id}`, {
            method: 'PATCH',
            headers: { Authorization: `Bearer ${airtableToken}`, 'Content-Type': 'application/json' },
            body: JSON.stringify({ fields: { CheckIn: true, Persona: p } })
          });
          location.reload();
        } else {
          if (!confirm("¿Eliminar check-in?")) return;
          await fetch(`${url}/${record.id}`, {
            method: 'PATCH',
            headers: { Authorization: `Bearer ${airtableToken}`, 'Content-Type': 'application/json' },
            body: JSON.stringify({ fields: { CheckIn: false, Persona: '' } })
          });
          location.reload();
        }
      });
    }
  });
}